import{j as e,r as l,a as L,q as I}from"./app-CRDvNyL1.js";import{d as M}from"./index-zJx878tr.js";import{M as P}from"./MainLayout-DS_-69MZ.js";import{V as E}from"./VenueCard-CJk2-uer.js";import"./Footer-C_GgISE5.js";const O=({search:t,setSearch:n,onSearchClick:m})=>e.jsxs("div",{className:"flex w-full max-w-md",children:[e.jsx("input",{type:"text",value:t,onChange:r=>n(r.target.value),placeholder:"Cari Lapangan",className:"w-full px-4 py-2 rounded-l-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500"}),e.jsx("button",{onClick:m,className:"px-6 py-2 bg-gray-600 text-white rounded-r-lg hover:bg-gray-700",children:"Cari"})]});function V({venue:t,onClose:n}){var w;const[m,r]=l.useState(1),[p,x]=l.useState(new Date().toISOString().split("T")[0]),[i,o]=l.useState([]),[c,S]=l.useState({name:"",phone:""}),[u,v]=l.useState(""),[d,h]=l.useState({}),[b,k]=l.useState(!1),C=["07:00-08:00","08:00-09:00","09:00-10:00","10:00-11:00","11:00-12:00","12:00-13:00","13:00-14:00","14:00-15:00","15:00-16:00","16:00-17:00","17:00-18:00","18:00-19:00","19:00-20:00","20:00-21:00","21:00-22:00","22:00-23:00"];l.useEffect(()=>{const a=document.createElement("script");return a.src="https://app.sandbox.midtrans.com/snap/snap.js",a.setAttribute("data-client-key","SB-Mid-client-WOa0OBNSKV4pHDRF"),a.async=!0,document.body.appendChild(a),()=>document.body.removeChild(a)},[]);const T=a=>{o(s=>s.includes(a)?s.filter(y=>y!==a):[...s,a])},j=()=>(t.price||0)*i.length,D=async()=>{const a={};if(c.name.trim()||(a.name="Nama wajib diisi"),c.phone.trim()||(a.phone="Nomor telepon wajib diisi"),u||(a.payment="Pilih metode pembayaran"),Object.keys(a).length>0){h(a);return}k(!0);try{const s={venue_id:t.id,date:p,times:i,name:c.name,phone:c.phone,amount:j(),payment_method:u},y=await L.post("http://localhost:8000/api/booking",s,{headers:{"Content-Type":"application/json"}});console.log("Snap Token:",f),console.log("Midtrans Key:","SB-Mid-client-WOa0OBNSKV4pHDRF");const{snap_token:f}=y.data;console.log("Snap Token:",f),window.snap.pay(f,{onSuccess:function(N){alert("Pembayaran berhasil!"),n()},onPending:function(N){alert("Menunggu pembayaran..."),n()},onError:function(N){console.error("Payment Error:",N),alert("Pembayaran gagal!")},onClose:function(){alert("Kamu menutup popup pembayaran.")}})}catch(s){console.error("Gagal memulai pembayaran:",s),alert("Terjadi kesalahan saat proses pembayaran.")}finally{k(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white max-w-2xl w-full rounded-lg shadow-lg overflow-y-auto max-h-[90vh] p-6 relative",children:[e.jsx("button",{onClick:n,className:"absolute top-3 right-4 text-gray-600 hover:text-black text-xl font-bold",children:"Ã—"}),m===1&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.image?`/storage/${t.image}`:"/images/default.jpg",alt:t.name,className:"w-full h-60 object-cover rounded mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:t.name}),e.jsxs("p",{className:"text-gray-600 mb-1",children:["Lokasi: ",t.location]}),e.jsxs("p",{className:"text-gray-600 mb-1",children:["Harga: Rp. ",(w=t.price)==null?void 0:w.toLocaleString("id-ID")," / jam"]}),e.jsxs("p",{className:"text-gray-600 mb-1",children:["Tipe: ",t.type]}),t.facilities&&t.facilities.length>0&&e.jsxs("p",{className:"text-gray-600 mb-4",children:["Fasilitas: ",Array.isArray(t.facilities)?t.facilities.join(", "):t.facilities]}),e.jsx("label",{className:"block mb-2 font-semibold",children:"Tanggal"}),e.jsx("input",{type:"date",value:p,onChange:a=>{x(a.target.value),o([])},min:new Date().toISOString().split("T")[0],className:"border rounded px-3 py-2 w-full mb-4"}),e.jsx("label",{className:"block mb-2 font-semibold",children:"Pilih Jam"}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-4",children:C.map(a=>e.jsx("button",{onClick:()=>T(a),className:`py-1 text-sm rounded ${i.includes(a)?"bg-green-500 text-white":"bg-gray-200 hover:bg-gray-300"}`,children:a},a))}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsxs("span",{className:"font-semibold",children:["Total: Rp. ",j().toLocaleString("id-ID")]}),e.jsx("button",{onClick:()=>i.length>0&&r(2),className:`px-4 py-2 rounded ${i.length>0?"bg-green-500 text-white hover:bg-green-600":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,disabled:i.length===0,children:"Lanjutkan"})]})]}),m===2&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Isi Data & Pembayaran"}),e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 mb-6 text-sm space-y-2",children:[e.jsx(g,{label:"Lapangan",value:t.name}),e.jsx(g,{label:"Tanggal",value:p}),e.jsx(g,{label:"Jam",value:i.join(", ")}),e.jsx(g,{label:"Total Harga",value:`Rp. ${j().toLocaleString("id-ID")}`})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Nama Lengkap"}),e.jsx("input",{type:"text",className:`w-full border rounded px-3 py-2 ${d.name?"border-red-500":""}`,value:c.name,onChange:a=>{S({...c,name:a.target.value}),h(s=>({...s,name:null}))}}),d.name&&e.jsx("p",{className:"text-red-500 text-sm",children:d.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Nomor Telepon"}),e.jsx("input",{type:"text",className:`w-full border rounded px-3 py-2 ${d.phone?"border-red-500":""}`,value:c.phone,onChange:a=>{S({...c,phone:a.target.value}),h(s=>({...s,phone:null}))}}),d.phone&&e.jsx("p",{className:"text-red-500 text-sm",children:d.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-2",children:"Metode Pembayaran"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",value:"midtrans",checked:u==="midtrans",onChange:a=>v(a.target.value)}),e.jsx("span",{children:"Bayar Online (QRIS / Bank Transfer / E-Wallet)"})]})}),d.payment&&e.jsx("p",{className:"text-red-500 text-sm",children:d.payment})]})]}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsx("button",{onClick:()=>r(1),className:"px-4 py-2 border rounded",children:"Kembali"}),e.jsx("button",{onClick:D,disabled:b,className:`px-4 py-2 rounded text-white ${b?"bg-gray-400":"bg-green-500 hover:bg-green-600"}`,children:b?"Memproses...":"Bayar Sekarang"})]})]})]})})}const g=({label:t,value:n})=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"w-32 font-medium text-gray-600",children:t}),e.jsxs("span",{className:"text-gray-800",children:[": ",n]})]});function H(){const{venues:t}=I().props,[n,m]=l.useState(""),[r,p]=l.useState(null),x=t.filter(o=>o.name.toLowerCase().includes(n.toLowerCase())),i=()=>{r&&M.Inertia.visit("/booking",{method:"get",data:{venue_id:r.id,date:new Date().toISOString().split("T")[0],times:"08:00-09:00"}})};return e.jsxs(P,{children:[e.jsxs("div",{className:"px-6 py-8",children:[e.jsx("h1",{className:"text-2xl text-center font-bold mb-6",children:"Daftar Lapangan"}),e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsx(O,{search:n,setSearch:m,onSearchClick:()=>{}})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:x.length>0?x.map(o=>e.jsx(E,{venue:o,onClick:()=>{console.log("Venue clicked:",o),p(o)}},o.id)):e.jsx("p",{className:"text-gray-500 col-span-full text-center",children:"Lapangan tidak ditemukan."})})]}),r&&e.jsx(V,{venue:r,selectedDate:new Date().toISOString().split("T")[0],selectedTimes:["08:00-09:00"],onClose:()=>p(null),onConfirm:i})]})}export{H as default};
